services:
  recallium:
    image: recalliumai/recallium:latest
    container_name: ${CONTAINER_NAME:-recallium}
    restart: unless-stopped
    ports:
      # Using [::] for IPv6 dual-stack (supports both IPv4 and IPv6, fixes Safari localhost issue)
      - "[::]:${HOST_UI_PORT:-9001}:9000"       # Web UI (internal 9000)
      - "[::]:${HOST_API_PORT:-8001}:8000"      # MCP API (internal 8000)
      - "[::]:${HOST_POSTGRES_PORT:-5433}:5432" # PostgreSQL
    volumes:
      - data:/data
      - wal:/wal
      - docs:/documents
      - secrets:/secrets
    env_file:
      - recallium.env
    extra_hosts:
      - "host.docker.internal:host-gateway"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  data:
    name: ${VOLUME_NAME:-recallium-v1}
  wal:
    name: ${VOLUME_NAME:-recallium-v1}-wal
  docs:
    name: ${VOLUME_NAME:-recallium-v1}-docs
  secrets:
    name: ${VOLUME_NAME:-recallium-v1}-secrets
